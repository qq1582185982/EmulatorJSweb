<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmulatorJS Ê∏∏Êàè‰∏≠ÂøÉ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .filter-bar .left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-bar select {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        #logout-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
        }

        #logout-btn:hover {
            background: #5568d3;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }

        .game-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .game-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .game-info {
            padding: 20px;
        }

        .game-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .game-system {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .game-desc {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .no-games {
            text-align: center;
            color: white;
            font-size: 1.5em;
            margin-top: 50px;
        }

        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 2em;
                margin-bottom: 8px;
            }

            .subtitle {
                font-size: 1em;
            }

            header {
                margin-bottom: 25px;
            }

            .filter-bar {
                padding: 15px;
                margin-bottom: 20px;
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 15px;
            }

            .filter-bar .left {
                flex-direction: column;
                align-items: stretch;
                margin-bottom: 0;
                gap: 8px;
            }

            .filter-bar label {
                margin-bottom: 0;
            }

            .filter-bar select {
                padding: 10px 12px;
                font-size: 14px;
                width: 100%;
            }

            #logout-btn {
                padding: 10px 16px;
                font-size: 14px;
                width: 100%;
                margin-top: 0;
            }

            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 15px;
            }

            .game-image {
                height: 140px;
                font-size: 2em;
            }

            .game-info {
                padding: 15px;
            }

            .game-title {
                font-size: 1em;
            }

            .game-desc {
                font-size: 0.85em;
            }
        }

        /* Â∞èÂ±èÊâãÊú∫ÈÄÇÈÖç */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8em;
            }

            .subtitle {
                font-size: 0.9em;
            }

            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }

            .game-image {
                height: 120px;
                font-size: 1.8em;
            }

            .game-info {
                padding: 12px;
            }

            .game-title {
                font-size: 0.95em;
            }

            .game-system {
                font-size: 0.8em;
                padding: 4px 10px;
            }

            .game-desc {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ EmulatorJS Ê∏∏Êàè‰∏≠ÂøÉ</h1>
            <p class="subtitle">Âú®Á∫øÊ∏∏Áé©ÁªèÂÖ∏Ê∏∏ÊàèÔºåÂ≠òÊ°£Ëá™Âä®‰∫ëÁ´Ø‰øùÂ≠ò</p>
        </header>

        <div class="filter-bar">
            <div class="left">
                <label>Á≠õÈÄâÊ∏∏ÊàèÊú∫Ôºö</label>
                <select id="systemFilter" onchange="filterGames()">
                    <option value="all">ÂÖ®ÈÉ®Ê∏∏ÊàèÊú∫</option>
                    <optgroup label="üéÆ ‰ªªÂ§©Â†Ç Nintendo">
                        <option value="nes">‰ªªÂ§©Â†Ç NES</option>
                        <option value="snes">Ë∂ÖÁ∫ß‰ªªÂ§©Â†Ç SNES</option>
                        <option value="n64">‰ªªÂ§©Â†Ç 64</option>
                        <option value="nds">‰ªªÂ§©Â†Ç DS</option>
                        <option value="gba">Game Boy Advance</option>
                        <option value="gb">Game Boy</option>
                        <option value="vb">Virtual Boy</option>
                    </optgroup>
                    <optgroup label="üéÆ ‰∏ñÂòâ Sega">
                        <option value="segaMD">‰∏ñÂòâ MD / Genesis</option>
                        <option value="segaMS">‰∏ñÂòâ Master System</option>
                        <option value="segaGG">‰∏ñÂòâ Game Gear</option>
                        <option value="segaCD">‰∏ñÂòâ CD</option>
                        <option value="sega32x">‰∏ñÂòâ 32X</option>
                        <option value="segaSaturn">‰∏ñÂòâ Saturn</option>
                    </optgroup>
                    <optgroup label="üéÆ Á¥¢Â∞º Sony">
                        <option value="psx">PlayStation</option>
                        <option value="psp">PlayStation Portable</option>
                    </optgroup>
                    <optgroup label="üéÆ ÈõÖËææÂà© Atari">
                        <option value="atari2600">Atari 2600</option>
                        <option value="atari5200">Atari 5200</option>
                        <option value="atari7800">Atari 7800</option>
                        <option value="lynx">Atari Lynx</option>
                        <option value="jaguar">Atari Jaguar</option>
                    </optgroup>
                    <optgroup label="üíª Commodore">
                        <option value="c64">Commodore 64</option>
                        <option value="c128">Commodore 128</option>
                        <option value="amiga">Commodore Amiga</option>
                        <option value="vic20">Commodore VIC-20</option>
                    </optgroup>
                    <optgroup label="üïπÔ∏è ÂÖ∂‰ªñ Other">
                        <option value="arcade">Ë°óÊú∫ Arcade</option>
                        <option value="mame2003">MAME 2003</option>
                        <option value="3do">3DO</option>
                        <option value="coleco">ColecoVision</option>
                    </optgroup>
                </select>
            </div>
            <button id="logout-btn" onclick="logout()">ÈÄÄÂá∫ÁôªÂΩï</button>
        </div>

        <div class="games-grid" id="gamesGrid">
            <!-- Ê∏∏ÊàèÂç°ÁâáÂ∞ÜÁî±JavaScriptÂä®ÊÄÅÁîüÊàê -->
        </div>

        <div class="no-games" id="noGames" style="display:none;">
            ÊöÇÊó†Ê∏∏ÊàèÔºåËØ∑ÂÖà‰∏ä‰º†ROMÊñá‰ª∂Âà∞ÊúçÂä°Âô®
        </div>
    </div>

    <script>
        // Ê∏∏ÊàèÊï∞ÊçÆÈÖçÁΩÆ
        const gamesConfig = {
            nes: {
                name: '‰ªªÂ§©Â†Ç NES',
                color: '#E60012',
                icon: 'üéÆ',
                games: []
            },
            snes: {
                name: 'Ë∂ÖÁ∫ß‰ªªÂ§©Â†Ç',
                color: '#8F8F8F',
                icon: 'üéØ',
                games: []
            },
            gba: {
                name: 'GBA',
                color: '#5E2CA5',
                icon: 'üé∞',
                games: []
            },
            gb: {
                name: 'Game Boy',
                color: '#9BBC0F',
                icon: 'üì±',
                games: []
            },
            n64: {
                name: '‰ªªÂ§©Â†Ç64',
                color: '#0066CC',
                icon: 'üé≤',
                games: []
            },
            psx: {
                name: 'PlayStation',
                color: '#003791',
                icon: 'üé™',
                games: []
            }
        };

        // ‰ªéÊúçÂä°Âô®Âä†ËΩΩÊ∏∏ÊàèÂàóË°®
        async function loadGames() {
            try {
                const response = await fetch('/api/list-games');
                const systems = await response.json();

                // ËΩ¨Êç¢‰∏∫ÊâÅÂπ≥ÁöÑÊ∏∏ÊàèÂàóË°®
                const allGames = [];
                systems.forEach(sys => {
                    sys.games.forEach(game => {
                        allGames.push({
                            system: sys.system,
                            name: game.name,
                            file: game.file,
                            description: game.desc || 'ÁªèÂÖ∏Ê∏∏Êàè'
                        });
                    });
                });

                window.allGamesList = allGames;
                window.systemsList = systems;
                renderGames(allGames);
            } catch (error) {
                console.error('Âä†ËΩΩÊ∏∏ÊàèÂàóË°®Â§±Ë¥•:', error);
                document.getElementById('gamesGrid').style.display = 'none';
                document.getElementById('noGames').style.display = 'block';
            }
        }

        // Ê∏≤ÊüìÊ∏∏ÊàèÂàóË°®
        function renderGames(games) {
            const grid = document.getElementById('gamesGrid');
            const noGames = document.getElementById('noGames');

            if (games.length === 0) {
                grid.style.display = 'none';
                noGames.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            noGames.style.display = 'none';
            grid.innerHTML = '';

            games.forEach(game => {
                const systemInfo = gamesConfig[game.system] || { name: game.system, color: '#666', icon: 'üéÆ' };
                const card = document.createElement('div');
                card.className = 'game-card';
                card.onclick = () => playGame(game.system, game.file);

                card.innerHTML = `
                    <div class="game-image" style="background: ${systemInfo.color}">
                        <span>${systemInfo.icon}</span>
                    </div>
                    <div class="game-info">
                        <div class="game-title">${game.name}</div>
                        <span class="game-system">${systemInfo.name}</span>
                        <div class="game-desc">${game.description || 'ÁªèÂÖ∏Ê∏∏Êàè'}</div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        // Á≠õÈÄâÊ∏∏Êàè
        function filterGames() {
            // TODO: ÂÆûÁé∞Á≠õÈÄâÈÄªËæë
        }

        // ÂêØÂä®Ê∏∏Êàè
        function playGame(system, file) {
            window.location.href = `player.html?system=${system}&rom=${encodeURIComponent(file)}`;
        }

        // ÈÄÄÂá∫ÁôªÂΩï
        function logout() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
                localStorage.removeItem('emulatorjs_user_id');
                localStorage.removeItem('emulatorjs_username');
                window.location.href = 'login.html';
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂ÂàùÂßãÂåñ
        window.onload = () => {
            // Ê£ÄÊü•ÁôªÂΩïÁä∂ÊÄÅ
            const userId = localStorage.getItem('emulatorjs_user_id');
            const username = localStorage.getItem('emulatorjs_username');

            if (!userId || !username) {
                // Êú™ÁôªÂΩïÔºåË∑≥ËΩ¨Âà∞ÁôªÂΩïÈ°µ
                window.location.href = 'login.html';
                return;
            }

            // Â∑≤ÁôªÂΩïÔºåÊòæÁ§∫Áî®Êà∑ÂêçÂπ∂Âä†ËΩΩÊ∏∏Êàè
            document.querySelector('.subtitle').textContent = `Ê¨¢ËøéÂõûÊù•Ôºå${username}ÔºÅÂú®Á∫øÊ∏∏Áé©ÁªèÂÖ∏Ê∏∏ÊàèÔºåÂ≠òÊ°£Ëá™Âä®‰∫ëÁ´Ø‰øùÂ≠ò`;
            loadGames();
        };
    </script>
</body>
</html>
