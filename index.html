<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmulatorJS æ¸¸æˆä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .filter-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .filter-bar .left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-bar select {
            padding: 10px 15px;
            border: 2px solid #667eea;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        #logout-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
        }

        #logout-btn:hover {
            background: #5568d3;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }

        .game-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .game-image {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .game-info {
            padding: 20px;
        }

        .game-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .game-system {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }

        .game-desc {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .no-games {
            text-align: center;
            color: white;
            font-size: 1.5em;
            margin-top: 50px;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 2em;
                margin-bottom: 8px;
            }

            .subtitle {
                font-size: 1em;
            }

            header {
                margin-bottom: 25px;
            }

            .filter-bar {
                padding: 15px;
                margin-bottom: 20px;
                flex-direction: column !important;
                align-items: stretch !important;
                gap: 15px;
            }

            .filter-bar .left {
                flex-direction: column;
                align-items: stretch;
                margin-bottom: 0;
                gap: 8px;
            }

            .filter-bar label {
                margin-bottom: 0;
            }

            .filter-bar select {
                padding: 10px 12px;
                font-size: 14px;
                width: 100%;
            }

            #logout-btn {
                padding: 10px 16px;
                font-size: 14px;
                width: 100%;
                margin-top: 0;
            }

            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
                gap: 15px;
            }

            .game-image {
                height: 140px;
                font-size: 2em;
            }

            .game-info {
                padding: 15px;
            }

            .game-title {
                font-size: 1em;
            }

            .game-desc {
                font-size: 0.85em;
            }
        }

        /* å°å±æ‰‹æœºé€‚é… */
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8em;
            }

            .subtitle {
                font-size: 0.9em;
            }

            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 12px;
            }

            .game-image {
                height: 120px;
                font-size: 1.8em;
            }

            .game-info {
                padding: 12px;
            }

            .game-title {
                font-size: 0.95em;
            }

            .game-system {
                font-size: 0.8em;
                padding: 4px 10px;
            }

            .game-desc {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ® EmulatorJS æ¸¸æˆä¸­å¿ƒ</h1>
            <p class="subtitle">åœ¨çº¿æ¸¸ç©ç»å…¸æ¸¸æˆï¼Œå­˜æ¡£è‡ªåŠ¨äº‘ç«¯ä¿å­˜</p>
        </header>

        <div class="filter-bar">
            <div class="left">
                <label>ç­›é€‰æ¸¸æˆæœºï¼š</label>
                <select id="systemFilter" onchange="filterGames()">
                    <option value="all">å…¨éƒ¨æ¸¸æˆæœº</option>
                    <optgroup label="ğŸ® ä»»å¤©å ‚ Nintendo">
                        <option value="nes">ä»»å¤©å ‚ NES</option>
                        <option value="snes">è¶…çº§ä»»å¤©å ‚ SNES</option>
                        <option value="n64">ä»»å¤©å ‚ 64</option>
                        <option value="nds">ä»»å¤©å ‚ DS</option>
                        <option value="gba">Game Boy Advance</option>
                        <option value="gb">Game Boy</option>
                        <option value="vb">Virtual Boy</option>
                    </optgroup>
                    <optgroup label="ğŸ® ä¸–å˜‰ Sega">
                        <option value="segaMD">ä¸–å˜‰ MD / Genesis</option>
                        <option value="segaMS">ä¸–å˜‰ Master System</option>
                        <option value="segaGG">ä¸–å˜‰ Game Gear</option>
                        <option value="segaCD">ä¸–å˜‰ CD</option>
                        <option value="sega32x">ä¸–å˜‰ 32X</option>
                        <option value="segaSaturn">ä¸–å˜‰ Saturn</option>
                    </optgroup>
                    <optgroup label="ğŸ® ç´¢å°¼ Sony">
                        <option value="psx">PlayStation</option>
                        <option value="psp">PlayStation Portable</option>
                    </optgroup>
                    <optgroup label="ğŸ® é›…è¾¾åˆ© Atari">
                        <option value="atari2600">Atari 2600</option>
                        <option value="atari5200">Atari 5200</option>
                        <option value="atari7800">Atari 7800</option>
                        <option value="lynx">Atari Lynx</option>
                        <option value="jaguar">Atari Jaguar</option>
                    </optgroup>
                    <optgroup label="ğŸ’» Commodore">
                        <option value="c64">Commodore 64</option>
                        <option value="c128">Commodore 128</option>
                        <option value="amiga">Commodore Amiga</option>
                        <option value="vic20">Commodore VIC-20</option>
                    </optgroup>
                    <optgroup label="ğŸ•¹ï¸ å…¶ä»– Other">
                        <option value="arcade">è¡—æœº Arcade</option>
                        <option value="mame2003">MAME 2003</option>
                        <option value="3do">3DO</option>
                        <option value="coleco">ColecoVision</option>
                    </optgroup>
                </select>
            </div>
            <button id="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>

        <div class="games-grid" id="gamesGrid">
            <!-- æ¸¸æˆå¡ç‰‡å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div class="no-games" id="noGames" style="display:none;">
            æš‚æ— æ¸¸æˆï¼Œè¯·å…ˆä¸Šä¼ ROMæ–‡ä»¶åˆ°æœåŠ¡å™¨
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®é…ç½®
        const gamesConfig = {
            nes: {
                name: 'ä»»å¤©å ‚ NES',
                color: '#E60012',
                icon: 'ğŸ®',
                games: []
            },
            snes: {
                name: 'è¶…çº§ä»»å¤©å ‚',
                color: '#8F8F8F',
                icon: 'ğŸ¯',
                games: []
            },
            gba: {
                name: 'GBA',
                color: '#5E2CA5',
                icon: 'ğŸ°',
                games: []
            },
            gb: {
                name: 'Game Boy',
                color: '#9BBC0F',
                icon: 'ğŸ“±',
                games: []
            },
            n64: {
                name: 'ä»»å¤©å ‚64',
                color: '#0066CC',
                icon: 'ğŸ²',
                games: []
            },
            psx: {
                name: 'PlayStation',
                color: '#003791',
                icon: 'ğŸª',
                games: []
            }
        };

        // ä»æœåŠ¡å™¨åŠ è½½æ¸¸æˆåˆ—è¡¨
        async function loadGames() {
            try {
                const response = await fetch('/api/list-games');
                const systems = await response.json();

                // è½¬æ¢ä¸ºæ‰å¹³çš„æ¸¸æˆåˆ—è¡¨
                const allGames = [];
                systems.forEach(sys => {
                    sys.games.forEach(game => {
                        allGames.push({
                            system: sys.system,
                            name: game.name,
                            file: game.file,
                            description: game.desc || 'ç»å…¸æ¸¸æˆ'
                        });
                    });
                });

                window.allGamesList = allGames;
                window.systemsList = systems;
                renderGames(allGames);
            } catch (error) {
                console.error('åŠ è½½æ¸¸æˆåˆ—è¡¨å¤±è´¥:', error);
                document.getElementById('gamesGrid').style.display = 'none';
                document.getElementById('noGames').style.display = 'block';
            }
        }

        // æ¸²æŸ“æ¸¸æˆåˆ—è¡¨
        function renderGames(games) {
            const grid = document.getElementById('gamesGrid');
            const noGames = document.getElementById('noGames');

            if (games.length === 0) {
                grid.style.display = 'none';
                noGames.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            noGames.style.display = 'none';
            grid.innerHTML = '';

            games.forEach(game => {
                const systemInfo = gamesConfig[game.system] || { name: game.system, color: '#666', icon: 'ğŸ®' };
                const card = document.createElement('div');
                card.className = 'game-card';
                card.onclick = () => playGame(game.system, game.file);

                card.innerHTML = `
                    <div class="game-image" style="background: ${systemInfo.color}">
                        <span>${systemInfo.icon}</span>
                    </div>
                    <div class="game-info">
                        <div class="game-title">${game.name}</div>
                        <span class="game-system">${systemInfo.name}</span>
                        <div class="game-desc">${game.description || 'ç»å…¸æ¸¸æˆ'}</div>
                    </div>
                `;

                grid.appendChild(card);
            });
        }

        // ç­›é€‰æ¸¸æˆ
        function filterGames() {
            // TODO: å®ç°ç­›é€‰é€»è¾‘
        }

        // å¯åŠ¨æ¸¸æˆ
        function playGame(system, file) {
            window.location.href = `player.html?system=${system}&rom=${encodeURIComponent(file)}`;
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                localStorage.removeItem('emulatorjs_user_id');
                localStorage.removeItem('emulatorjs_username');
                window.location.href = 'login.html';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = () => {
            // æ£€æŸ¥ç™»å½•çŠ¶æ€
            const userId = localStorage.getItem('emulatorjs_user_id');
            const username = localStorage.getItem('emulatorjs_username');

            if (!userId || !username) {
                // æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
                window.location.href = 'login.html';
                return;
            }

            // å·²ç™»å½•ï¼Œæ˜¾ç¤ºç”¨æˆ·åå¹¶åŠ è½½æ¸¸æˆ
            document.querySelector('.subtitle').textContent = `æ¬¢è¿å›æ¥ï¼Œ${username}ï¼åœ¨çº¿æ¸¸ç©ç»å…¸æ¸¸æˆï¼Œå­˜æ¡£è‡ªåŠ¨äº‘ç«¯ä¿å­˜`;
            loadGames();
        };
    </script>
</body>
</html>
